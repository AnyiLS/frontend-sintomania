let DEBUG=!1,board=new Board(6),rules=new Rules(board);var dragDropInfo=null;if("/world-1"===window.location.pathname){function o(){var o=rules.getRandomValidMove(),e=document.getElementById("canvas").getContext("2d");e.clearRect(0,0,320,320);var t=o.candy.col,n=o.candy.row,r=320/board.boardSize,a=r/2,i=(t+1)*r-a,f=(n+1)*r-a;e.fillStyle="#333333",e.beginPath(),"up"==o.direction?(e.fillRect(i-a/2,f-a,a,a),e.moveTo(i-a,f-a+1),e.lineTo(i,f-2*a),e.lineTo(i+a,f-a+1)):"down"==o.direction?(e.fillRect(i-a/2,f,a,a),e.moveTo(i+a,f+a-1),e.lineTo(i,f+a+a),e.lineTo(i-a,f+a-1)):"left"==o.direction?(e.fillRect(i-a,f-a/2,a,a),e.moveTo(i-a+1,f-a),e.lineTo(i-2*a,f),e.lineTo(i-a+1,f+a)):"right"==o.direction&&(e.fillRect(i,f-a/2,a,a),e.moveTo(i+a-1,f+a),e.lineTo(i+2*a,f),e.lineTo(i+a-1,f-a)),e.closePath(),e.fill()}function e(){document.getElementById("canvas").getContext("2d").clearRect(0,0,320,320)}function t(){setTimeout(function(){rules.moveCandiesDown()},1e3),rules.removeCrushes(rules.getCandyCrushes())}function n(){board.clear(),board.resetScore(),rules.prepareNewGame()}$.extend({getUrlVars:function(){let o=[],e,t=window.location.search.substr(1).split("&");for(let n=0;n<t.length;n++)e=t[n].split("="),o.push(e[0]),o[e[0]]=e[1]&&decodeURIComponent(e[1].replace(/\+/g," "));return o},getUrlVar:function(o){return $.getUrlVars()[o]}}),$(document).ready(function(){n(),$(board).on("add",()=>{console.log("Se la jugue")}),console.log(board),setTimeout(()=>{console.log("board",document.querySelector(".content-game")),$(board).on("move",()=>{console.log("a movernos")})},500)}),$(board).on("move",function(o,e){var n=document.getElementById("candy-id-"+e.candy.id);$(n).attr("data-position",e.toCol+"-"+e.toRow);var r=320/board.boardSize,a=e.toRow*r,i=e.toCol*r;$(n).animate({top:a,left:i},function(){t()})}),$(board).on("remove",function(o,e){var t=document.getElementById("candy-id-"+e.candy.id);$(t).animate({opacity:0},function(){t.parentNode.removeChild(t)})}),$(board).on("scoreUpdate",function(o,e){var t=document.getElementById("scoreLabel");$(t).empty(),$(t).append(e.score+" points"),void 0!=e.candy?($(t).css("background-color",e.candy.color),"yellow"==e.candy.color?$(t).css("color","gray"):$(t).css("color","white")):$(t).css({"background-color":"lightgrey",color:"black"})}),$(document).on("click",".btn",function(t){var r=t.target.id;"newGame"==r?!1==$("img").is(":animated")&&(e(),n()):"showMove"==r&&!1==$("img").is(":animated")&&(e(),o())}),$(document).on("keydown",function(o){"n"==o.originalEvent.key&&(e(),n())}),$(document).on("mousedown touchstart","#canvas",function(o){if(!1==$("img").is(":animated")){var e,t,n=320/board.boardSize;"mousedown"==o.type?(e=o.offsetX,t=o.offsetY):(e=parseInt(o.touches[0].clientX)-(parseInt(o.target.offsetLeft)+parseInt(o.target.offsetParent.offsetLeft)),t=parseInt(o.touches[0].clientY)-(parseInt(o.target.offsetTop)+parseInt(o.target.offsetParent.offsetTop)),DEBUG&&(console.log(o),console.log(parseInt(o.changedTouches[0].clientX),"- (",parseInt(o.target.offsetLeft),"+",parseInt(o.target.offsetParent.offsetLeft),") = ",e),console.log(parseInt(o.changedTouches[0].clientY),"- (",parseInt(o.target.offsetTop),"+",parseInt(o.target.offsetParent.offsetTop),") = ",t),$("#DEBUG").empty(),$("#DEBUG").append("s: "+e+" "+t)));var r=Math.floor(e/n),a=Math.floor(t/n),i=document.querySelectorAll("[data-position='"+r+"-"+a+"']").item(0);if(null!=i){$(i).css("z-index",2);var f=parseInt($(i).css("top")),d=parseInt($(i).css("left"));dragDropInfo={candyImg:i,initCol:r,initRow:a,initTop:f,initLeft:d,initXCoord:e,initYCoord:t}}}}),$(document).on("mousemove touchmove","#canvas",function(o){if(null!=dragDropInfo&&!1==$("img").is(":animated")){"mousemove"==o.type?(e=o.offsetX,t=o.offsetY):(DEBUG&&console.log(o),e=parseInt(o.touches[0].clientX)-(parseInt(o.target.offsetLeft)+parseInt(o.target.offsetParent.offsetLeft)),t=parseInt(o.touches[0].clientY)-(parseInt(o.target.offsetTop)+parseInt(o.target.offsetParent.offsetTop)));var e,t,n=dragDropInfo.initTop+t-dragDropInfo.initYCoord,r=dragDropInfo.initLeft+e-dragDropInfo.initXCoord;$(dragDropInfo.candyImg).css({top:n,left:r})}}),$(document).on("mouseup touchend",function(o){if(null!=dragDropInfo){e();var t,n,r=320/board.boardSize;"mouseup"==o.type?(t=o.offsetX,n=o.offsetY):(t=parseInt(o.changedTouches[0].clientX)-(parseInt(o.target.offsetLeft)+parseInt(o.target.offsetParent.offsetLeft)),n=parseInt(o.changedTouches[0].clientY)-(parseInt(o.target.offsetTop)+parseInt(o.target.offsetParent.offsetTop)),DEBUG&&(console.log(o),console.log(o.changedTouches),console.log(parseInt(o.changedTouches[0].clientX),"- (",parseInt(o.target.offsetLeft),"+",parseInt(o.target.offsetParent.offsetLeft),") = ",t),console.log(parseInt(o.changedTouches[0].clientY),"- (",parseInt(o.target.offsetTop),"+",parseInt(o.target.offsetParent.offsetTop),") = ",n),$("#DEBUG").append(", e: "+t+" "+n)));var a=Math.floor(t/r),i=Math.floor(n/r),f=$(dragDropInfo.candyImg).data("candy");dragDropInfo.initCol==a&&dragDropInfo.initRow-1==i?rules.isMoveTypeValid(f,"up")&&board.flipCandies(f,board.getCandyInDirection(f,"up")):dragDropInfo.initCol==a&&dragDropInfo.initRow+1==i?rules.isMoveTypeValid(f,"down")&&board.flipCandies(f,board.getCandyInDirection(f,"down")):dragDropInfo.initCol-1==a&&dragDropInfo.initRow==i?rules.isMoveTypeValid(f,"left")&&board.flipCandies(f,board.getCandyInDirection(f,"left")):dragDropInfo.initCol+1==a&&dragDropInfo.initRow==i&&rules.isMoveTypeValid(f,"right")&&board.flipCandies(f,board.getCandyInDirection(f,"right")),$(dragDropInfo.candyImg).css({"z-index":1,top:dragDropInfo.initTop,left:dragDropInfo.initLeft}),dragDropInfo=null}})}